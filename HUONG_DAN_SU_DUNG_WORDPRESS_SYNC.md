# H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG WORDPRESS SYNC - CHI TI·∫æT

## üéØ M·ª§C TI√äU
H∆∞·ªõng d·∫´n t·ª´ng b∆∞·ªõc ƒë·ªÉ d·ªØ li·ªáu t·∫°o m·ªõi t·ª´ frontend t·ª± ƒë·ªông ƒë∆∞·ª£c l∆∞u l√™n WordPress th√¥ng qua API.

## üìã KI·ªÇM TRA TR∆Ø·ªöC KHI B·∫ÆT ƒê·∫¶U

### 1. Ki·ªÉm tra WordPress ƒëang ch·∫°y
- M·ªü browser, truy c·∫≠p: `http://vhdcom.local`
- ƒê·∫£m b·∫£o WordPress hi·ªÉn th·ªã b√¨nh th∆∞·ªùng
- Ki·ªÉm tra REST API: `http://vhdcom.local/wp-json/wp/v2/posts`

### 2. Ki·ªÉm tra Next.js server ƒëang ch·∫°y
- Terminal hi·ªán t·∫°i ƒëang ch·∫°y: `http://localhost:3001` (t·ª´ log)
- Ki·ªÉm tra API endpoint: `http://localhost:3001/api/sync/wordpress?action=health`

## üîß B∆Ø·ªöC 1: C·∫§U H√åNH WORDPRESS SYNC

### C√°ch 1: Qua Admin Panel (Khuy√™n d√πng)
1. V√†o: `http://localhost:3001/admin/wordpress-settings`
2. Nh·∫≠p th√¥ng tin:
   - **API URL**: `http://vhdcom.local/wp-json/wp/v2`
   - **Username**: `admin`
   - **Password**: `admin` (ho·∫∑c Application Password)
   - **Enabled**: ‚úÖ Checked
3. Nh·∫•n "Save Settings"
4. Nh·∫•n "Test Connection" ƒë·ªÉ ki·ªÉm tra

### C√°ch 2: Qua Browser Console (Nhanh h∆°n)
1. V√†o b·∫•t k·ª≥ trang n√†o c·ªßa website
2. Nh·∫•n F12 ‚Üí Console tab
3. Copy v√† paste:

```javascript
// B·∫≠t t·∫•t c·∫£ sync settings
localStorage.setItem('wpSyncEnabled', 'true')
localStorage.setItem('autoSyncEnabled', 'true')
localStorage.setItem('bidirectionalSyncEnabled', 'true')

// C·∫•u h√¨nh WordPress settings
const wpSettings = {
  apiUrl: 'http://vhdcom.local/wp-json/wp/v2',
  username: 'admin',
  password: 'admin',
  enabled: true
}
localStorage.setItem('wordpressSettings', JSON.stringify(wpSettings))

console.log('‚úÖ WordPress sync ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh!')
location.reload()
```

## üß™ B∆Ø·ªöC 2: TEST WORDPRESS CONNECTION

Paste v√†o Console:

```javascript
// Test WordPress connection
const testWordPressConnection = async () => {
  console.log('üîç Testing WordPress connection...')
  
  try {
    // Test WordPress REST API
    const wpResponse = await fetch('http://vhdcom.local/wp-json/wp/v2/posts?per_page=1')
    if (wpResponse.ok) {
      console.log('‚úÖ WordPress REST API: ACCESSIBLE')
      const posts = await wpResponse.json()
      console.log('üìä WordPress posts found:', posts.length)
    } else {
      console.log('‚ùå WordPress REST API: FAILED')
      console.log('Status:', wpResponse.status)
    }
    
    // Test Frontend API
    const apiResponse = await fetch('http://localhost:3001/api/sync/wordpress?action=health')
    if (apiResponse.ok) {
      const apiData = await apiResponse.json()
      console.log('‚úÖ Frontend API: WORKING')
      console.log('üìä Health check:', apiData.success ? 'SUCCESS' : 'FAILED')
    } else {
      console.log('‚ùå Frontend API: FAILED')
      console.log('Status:', apiResponse.status)
    }
    
  } catch (error) {
    console.log('‚ùå Connection test failed:', error.message)
  }
}

testWordPressConnection()
```

## üöÄ B∆Ø·ªöC 3: T·∫†O TIN T·ª®C V√Ä KI·ªÇM TRA SYNC

### C√°ch 1: T·∫°o tin t·ª©c qua Admin Panel
1. V√†o: `http://localhost:3001/admin/news/create`
2. Nh·∫≠p th√¥ng tin tin t·ª©c:
   - **Ti√™u ƒë·ªÅ**: V√≠ d·ª• "Test News Sync"
   - **M√¥ t·∫£**: M√¥ t·∫£ ng·∫Øn
   - **N·ªôi dung chi ti·∫øt**: N·ªôi dung ƒë·∫ßy ƒë·ªß
   - **Tr·∫°ng th√°i**: Draft ho·∫∑c Published
3. Nh·∫•n "T·∫°o tin t·ª©c"
4. **Quan tr·ªçng**: M·ªü F12 ‚Üí Console ƒë·ªÉ xem log sync

### C√°ch 2: T·∫°o tin t·ª©c qua Console (Test)
Paste v√†o Console:

```javascript
// T·∫°o test news v√† sync
const createTestNews = async () => {
  console.log('üìù Creating test news...')
  
  const testNews = {
    id: Date.now(),
    title: `Test News ${new Date().toLocaleTimeString('vi-VN')}`,
    titleEn: `Test News ${new Date().toLocaleTimeString('vi-VN')}`,
    description: 'Tin t·ª©c test ƒë·ªÉ ki·ªÉm tra sync WordPress',
    descriptionEn: 'Test news to check WordPress sync',
    image: '/images/hoi_xuat_ban.png',
    category: 'Tin t·ª©c',
    categoryEn: 'News',
    date: new Date().toLocaleDateString('vi-VN'),
    detailContent: `<h1>Test News Sync</h1>
<p>ƒê√¢y l√† tin t·ª©c test ƒë·ªÉ ki·ªÉm tra sync WordPress.</p>
<p>Th·ªùi gian t·∫°o: ${new Date().toLocaleString('vi-VN')}</p>`,
    detailContentEn: `<h1>Test News Sync</h1>
<p>This is a test news to check WordPress sync.</p>
<p>Created at: ${new Date().toLocaleString('vi-VN')}</p>`,
    views: 0,
    readingTime: 2,
    status: 'draft',
    featured: false,
    tags: ['test', 'sync'],
    author: 'Test User',
    authorEn: 'Test User'
  }
  
  try {
    // Call API to create WordPress post
    console.log('üöÄ Calling WordPress sync API...')
    const response = await fetch('/api/sync/wordpress', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        action: 'create',
        data: testNews
      })
    })
    
    console.log('üì° API Response status:', response.status)
    
    if (response.ok) {
      const result = await response.json()
      console.log('‚úÖ WordPress post created successfully!')
      console.log('üìä WordPress Post ID:', result.wpId)
      console.log('üìä Result:', result)
      
      // Add to localStorage
      const existingNews = JSON.parse(localStorage.getItem('news') || '[]')
      testNews.wpId = result.wpId
      const updatedNews = [testNews, ...existingNews]
      localStorage.setItem('news', JSON.stringify(updatedNews))
      
      console.log('‚úÖ Test news added to localStorage with wpId:', result.wpId)
      console.log('üéØ Check WordPress admin: http://vhdcom.local/wp-admin/edit.php')
      
    } else {
      const errorText = await response.text()
      console.log('‚ùå WordPress post creation failed')
      console.log('üìã Error:', errorText)
    }
    
  } catch (error) {
    console.log('‚ùå API call failed:', error.message)
  }
}

createTestNews()
```

## üìä B∆Ø·ªöC 4: KI·ªÇM TRA K·∫æT QU·∫¢

### 1. Ki·ªÉm tra Console Logs
Sau khi t·∫°o tin t·ª©c, Console s·∫Ω hi·ªÉn th·ªã:
```
üîç Sync Settings Check: {wpSyncEnabled: true, autoSyncEnabled: true, willSync: true}
üöÄ Starting WordPress sync for news: [T√™n tin t·ª©c]
üì° Calling sync API...
üì° API Response status: 200
‚úÖ WordPress post created via API: {wpId: 123, message: "Post created successfully"}
‚úÖ ƒê√£ t·∫°o b√†i vi·∫øt WordPress th√†nh c√¥ng: 123
```

### 2. Ki·ªÉm tra WordPress Admin
1. V√†o: `http://vhdcom.local/wp-admin/edit.php`
2. ƒêƒÉng nh·∫≠p WordPress (admin/admin)
3. T√¨m b√†i vi·∫øt m·ªõi t·∫°o trong danh s√°ch
4. Ki·ªÉm tra n·ªôi dung b√†i vi·∫øt

### 3. Ki·ªÉm tra localStorage
Paste v√†o Console:
```javascript
// Ki·ªÉm tra tin t·ª©c trong localStorage
const news = JSON.parse(localStorage.getItem('news') || '[]')
console.log('üìä Total news:', news.length)
console.log('üìã Recent news with wpId:', 
  news.filter(n => n.wpId).slice(0, 3).map(n => ({
    id: n.id,
    title: n.title,
    wpId: n.wpId
  }))
)
```

## ‚ö†Ô∏è X·ª¨ L√ù L·ªñI TH∆Ø·ªúNG G·∫∂P

### L·ªói 401 - Authentication Failed
**Nguy√™n nh√¢n**: Sai username/password
**Gi·∫£i ph√°p**:
1. V√†o: `http://vhdcom.local/wp-admin/profile.php`
2. T√¨m "Application Passwords"
3. T·∫°o password m·ªõi t√™n "Frontend Sync"
4. Copy password ƒë∆∞·ª£c t·∫°o
5. C·∫≠p nh·∫≠t settings:
```javascript
const wpSettings = {
  apiUrl: 'http://vhdcom.local/wp-json/wp/v2',
  username: 'admin',
  password: 'YOUR_APPLICATION_PASSWORD_HERE', // Paste password ·ªü ƒë√¢y
  enabled: true
}
localStorage.setItem('wordpressSettings', JSON.stringify(wpSettings))
location.reload()
```

### L·ªói 403 - Permission Denied
**Nguy√™n nh√¢n**: User kh√¥ng c√≥ quy·ªÅn t·∫°o post
**Gi·∫£i ph√°p**: ƒê·∫£m b·∫£o user c√≥ role Editor ho·∫∑c Administrator

### L·ªói 404 - Not Found
**Nguy√™n nh√¢n**: WordPress kh√¥ng ch·∫°y ho·∫∑c REST API b·ªã t·∫Øt
**Gi·∫£i ph√°p**: 
1. Ki·ªÉm tra WordPress ch·∫°y: `http://vhdcom.local`
2. Ki·ªÉm tra permalink settings trong WordPress admin

### L·ªói 500 - Server Error
**Nguy√™n nh√¢n**: L·ªói server WordPress
**Gi·∫£i ph√°p**: Ki·ªÉm tra WordPress error logs

## üîÑ WORKFLOW HO√ÄN CH·ªàNH

1. **C·∫•u h√¨nh** ‚Üí Settings ƒë∆∞·ª£c l∆∞u trong localStorage
2. **T·∫°o tin t·ª©c** ‚Üí NewsContext.addNews() ƒë∆∞·ª£c g·ªçi
3. **Auto sync** ‚Üí createWordPressPost() ƒë∆∞·ª£c trigger
4. **API call** ‚Üí POST /api/sync/wordpress v·ªõi action='create'
5. **WordPress** ‚Üí Post ƒë∆∞·ª£c t·∫°o v·ªõi status draft/publish
6. **Update local** ‚Üí wpId ƒë∆∞·ª£c l∆∞u v√†o localStorage
7. **Ho√†n th√†nh** ‚Üí Tin t·ª©c c√≥ m·∫∑t c·∫£ local v√† WordPress

## üéØ KI·ªÇM TRA CU·ªêI C√ôNG

Paste v√†o Console ƒë·ªÉ ki·ªÉm tra to√†n b·ªô h·ªá th·ªëng:

```javascript
// Comprehensive system check
const systemCheck = async () => {
  console.log('üîç COMPREHENSIVE SYSTEM CHECK\n')
  
  // 1. Check settings
  const wpSync = localStorage.getItem('wpSyncEnabled') === 'true'
  const autoSync = localStorage.getItem('autoSyncEnabled') === 'true'
  const wpSettings = localStorage.getItem('wordpressSettings')
  
  console.log('1Ô∏è‚É£ Settings:')
  console.log('   wpSyncEnabled:', wpSync)
  console.log('   autoSyncEnabled:', autoSync)
  console.log('   wpSettings:', !!wpSettings)
  
  // 2. Test connections
  console.log('\n2Ô∏è‚É£ Connections:')
  try {
    const wpTest = await fetch('http://vhdcom.local/wp-json/wp/v2/posts?per_page=1')
    console.log('   WordPress API:', wpTest.ok ? '‚úÖ OK' : '‚ùå FAILED')
    
    const apiTest = await fetch('/api/sync/wordpress?action=health')
    console.log('   Frontend API:', apiTest.ok ? '‚úÖ OK' : '‚ùå FAILED')
  } catch (e) {
    console.log('   Connection test failed:', e.message)
  }
  
  // 3. Check news data
  const news = JSON.parse(localStorage.getItem('news') || '[]')
  const newsWithWpId = news.filter(n => n.wpId)
  
  console.log('\n3Ô∏è‚É£ Data:')
  console.log('   Total news:', news.length)
  console.log('   News with wpId:', newsWithWpId.length)
  
  // 4. Summary
  console.log('\nüéØ SUMMARY:')
  if (wpSync && autoSync && wpSettings) {
    console.log('‚úÖ System ready for WordPress sync!')
    console.log('üí° Create news at: http://localhost:3001/admin/news/create')
  } else {
    console.log('‚ùå System not ready. Check settings above.')
  }
}

systemCheck()
```

## üìû H·ªñ TR·ª¢

N·∫øu v·∫´n g·∫∑p v·∫•n ƒë·ªÅ, ch·∫°y script debug:
```javascript
// Copy n·ªôi dung file debug-wordpress-sync.js v√†o Console
```

Ho·∫∑c ch·∫°y script fix nhanh:
```javascript
// Copy n·ªôi dung file fix-wordpress-sync-now.js v√†o Console
``` 